# アプリケーション設計 - 詳細ステップ

## 目的
**高レベルのコンポーネント識別とサービス層設計**

アプリケーション設計は以下に焦点を当てます：
- 主要な機能コンポーネントとその責任を識別
- コンポーネントインターフェースの定義（詳細なビジネスロジックではない）
- オーケストレーションのためのサービス層の設計
- コンポーネントの依存関係とコミュニケーションパターンの確立

**注意**：詳細なビジネスロジック設計は、後の機能設計（ユニットごと、CONSTRUCTIONフェーズ）で行われます

## 前提条件
- コンテキスト評価が完了している必要がある
- 要件評価が推奨される（機能的なコンテキストを提供）
- ストーリー開発が推奨される（ユーザーストーリーが設計決定をガイド）
- 実行計画がアプリケーション設計ステージを実行すべきことを示す必要がある

## ステップバイステップの実行

### 1. コンテキストを分析
- `aidlc-docs/inception/requirements/requirements.md`と`aidlc-docs/inception/user-stories/stories.md`を読み取る
- 主要なビジネス機能と機能領域を識別
- 設計のスコープと複雑さを決定

### 2. アプリケーション設計計画を作成
- アプリケーション設計のチェックボックス[]を含む計画を生成
- コンポーネント、責任、メソッド、ビジネスルール、サービスに焦点を当てる
- 各ステップとサブステップにチェックボックス[]を付ける

### 3. 計画に必須の設計成果物を含める
- **常に**設計計画にこれらの必須成果物を含める：
  - [ ] コンポーネント定義と高レベルの責任を含むcomponents.mdを生成
  - [ ] メソッド署名を含むcomponent-methods.mdを生成（ビジネスルールは後の機能設計で詳細化）
  - [ ] サービス定義とオーケストレーションパターンを含むservices.mdを生成
  - [ ] 依存関係の関係とコミュニケーションパターンを含むcomponent-dependency.mdを生成
  - [ ] 設計の完全性と一貫性を検証

### 4. コンテキストに適した質問を生成
**指示**：要件とストーリーを分析して、この特定のアプリケーション設計に関連する質問のみを生成します。以下のカテゴリをインスピレーションとして使用し、必須のチェックリストとしては使用しません。該当しない場合はカテゴリ全体をスキップします。

- [Answer]:タグ形式を使用して質問を埋め込む
- このコンテキストに特有の曖昧さと欠落している情報に焦点を当てる
- 設計決定にユーザー入力が必要な場所でのみ質問を生成

**質問カテゴリの例**（必要に応じて適応）：
- **コンポーネント識別** - コンポーネントの境界や組織が不明確な場合のみ
- **コンポーネントメソッド** - メソッド署名が明確化を必要とする場合のみ（詳細なビジネスルールは後で）
- **サービス層設計** - サービスオーケストレーションまたは境界が曖昧な場合のみ
- **コンポーネント依存関係** - コミュニケーションパターンまたは依存関係管理が不明確な場合のみ
- **設計パターン** - アーキテクチャスタイルまたはパターンの選択にユーザー入力が必要な場合のみ

### 5. アプリケーション設計計画を保存
- `aidlc-docs/inception/plans/application-design-plan.md`として保存
- ユーザー入力のためのすべての[Answer]:タグを含める
- 計画がすべての設計側面をカバーしていることを確認

### 6. ユーザー入力を要求
- ユーザーに計画ドキュメント内で直接[Answer]:タグを記入するよう依頼
- 設計決定の重要性を強調
- [Answer]:タグの完了について明確な指示を提供

### 7. 回答を収集
- ユーザーが[Answer]:タグを使用してすべての質問に回答するのを待つ
- すべての[Answer]:タグが完了するまで進まない
- ドキュメントを確認して、[Answer]:タグが空白のままになっていないことを確認

### 8. 回答を分析（必須）
進む前に、すべてのユーザーの回答を以下について慎重に確認する必要があります：
- **曖昧または曖昧な応答**：「混合」、「中間」、「確信がない」、「依存する」
- **未定義の基準または用語**：明確な定義のない概念への参照
- **矛盾する回答**：互いに矛盾する応答
- **欠落している設計の詳細**：具体的なガイダンスを欠く回答
- **オプションを組み合わせる回答**：明確な決定ルールなしで異なるアプローチをマージする応答

### 9. 必須のフォローアップ質問
ステップ8の分析で曖昧な回答が明らかになった場合、以下を行う必要があります：
- [Answer]:タグを使用して計画ドキュメントに具体的なフォローアップ質問を追加
- すべての曖昧さが解決されるまで承認に進まない
- 必要なフォローアップの例：
  - 「あなたは『AとBの混合』と言及しました - AとBのどちらを使用するかを決定する具体的な基準は何ですか？」
  - 「あなたは『AとBの中間』と言いました - 正確な中間アプローチを定義できますか？」
  - 「あなたは『確信がない』と示しました - 決定するのに役立つ追加情報は何ですか？」
  - 「あなたは『複雑さに依存する』と言及しました - 複雑さのレベルをどのように定義しますか？」

### 10. アプリケーション設計成果物を生成
- 承認された計画を実行して設計成果物を生成
- `aidlc-docs/inception/application-design/components.md`を作成：
  - コンポーネント名と目的
  - コンポーネントの責任
  - コンポーネントインターフェース
- `aidlc-docs/inception/application-design/component-methods.md`を作成：
  - 各コンポーネントのメソッド署名
  - 各メソッドの高レベルな目的
  - 入力/出力タイプ
  - 注意：詳細なビジネスルールは機能設計（ユニットごと、CONSTRUCTIONフェーズ）で定義されます
- `aidlc-docs/inception/application-design/services.md`を作成：
  - サービス定義
  - サービスの責任
  - サービスのインタラクションとオーケストレーション
- `aidlc-docs/inception/application-design/component-dependency.md`を作成：
  - 関係を示す依存関係マトリックス
  - コンポーネント間のコミュニケーションパターン
  - データフロー図

### 11. 承認を記録
- タイムスタンプ付きで`aidlc-docs/audit.md`に承認プロンプトを記録
- 完全な承認プロンプトテキストを含める
- ISO 8601タイムスタンプ形式を使用

### 12. 完了メッセージを提示

```markdown
# 🏗️ アプリケーション設計完了

[作成されたアプリケーション設計成果物のAI生成サマリー（箇条書き）]

> **📋 <u>**確認が必要：**</u>**  
> 以下のアプリケーション設計成果物を確認してください：`aidlc-docs/inception/application-design/`

> **🚀 <u>**次は何ですか？**</u>**
>
> **以下を行うことができます：**
>
> 🔧 **変更を要求** - 必要に応じてアプリケーション設計への変更を依頼
> [ユニット生成がスキップされる場合：]
> 📝 **ユニット生成を追加** - **ユニット生成**ステージを含めることを選択（現在スキップされています）
> ✅ **承認して続行** - 設計を承認して**[ユニット生成/CONSTRUCTIONフェーズ]**に進む
```

### 13. 明示的な承認を待つ
- ユーザーがアプリケーション設計を明示的に承認するまで進まない
- 承認は明確で曖昧さがない必要がある
- ユーザーが変更を要求した場合は、設計を更新して承認プロセスを繰り返す

### 14. 承認応答を記録
- タイムスタンプ付きでユーザーの承認応答を`aidlc-docs/audit.md`に記録
- 正確なユーザー応答テキストを含める
- 承認ステータスを明確にマーク

### 15. 進捗を更新
- `aidlc-docs/aidlc-state.md`でアプリケーション設計ステージを完了としてマーク
- 「現在のステータス」セクションを更新
- 次のステージへの移行を準備
