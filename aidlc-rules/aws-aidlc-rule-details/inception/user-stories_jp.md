# ユーザーストーリー - 詳細ステップ

## 目的
**要件を受け入れ基準を持つユーザー中心のストーリーに変換**

ユーザーストーリーは以下に焦点を当てます：
- ビジネス要件をユーザー中心の物語に翻訳
- 各ストーリーの明確な受け入れ基準を定義
- 異なる関係者タイプを表すユーザーペルソナを作成
- チーム間の共通理解を確立
- 実装のためのテスト可能な仕様を提供

## 前提条件
- ワークスペース検出が完了している必要がある
- 要件分析が推奨される（利用可能な場合は要件を参照できる）
- ワークフロー計画がユーザーストーリーステージを実行すべきことを示す必要がある

## インテリジェント評価ガイドライン

**ユーザーストーリーを実行するタイミング**：進む前にこの強化された評価を使用：

### 高優先度実行（常に実行）
- **新しいユーザー機能**：ユーザーが直接操作する新しい機能
- **ユーザーエクスペリエンスの変更**：既存のユーザーワークフローまたはインターフェースへの変更
- **マルチペルソナシステム**：異なるタイプのユーザーにサービスを提供するアプリケーション
- **顧客向けAPI**：外部ユーザーまたはシステムが消費するサービス
- **複雑なビジネスロジック**：複数のシナリオまたはビジネスルールを持つ要件
- **クロスチームプロジェクト**：複数のチーム間で共通理解を必要とする作業

### 中優先度実行（複雑さを評価）
- **バックエンドユーザーへの影響**：ユーザーエクスペリエンスに間接的に影響する内部変更
- **パフォーマンスの改善**：ユーザーに見える利点を持つ機能強化
- **統合作業**：ユーザーワークフローに影響するシステムの接続
- **データ変更**：ユーザーデータ、レポート、または分析に影響する変更
- **セキュリティ強化**：ユーザー認証または権限に影響する変更

### 複雑さ評価要因
中優先度のケースでは、次のいずれかが適用される場合にユーザーストーリーを実行：
- **スコープ**：変更が複数のコンポーネントまたはユーザータッチポイントにまたがる
- **曖昧さ**：要件にストーリーで明確化できる不明確な側面がある
- **リスク**：ビジネスへの影響が大きいか、誤解の可能性がある
- **関係者**：要件に複数のビジネス関係者が関与
- **テスト**：ユーザー受け入れテストが必要
- **オプション**：複数の有効な実装アプローチが存在

### シンプルなケースのみスキップ
- **純粋なリファクタリング**：ユーザーへの影響がゼロの内部コード改善
- **孤立したバグ修正**：明確なスコープを持つシンプルで明確に定義された修正
- **インフラストラクチャのみ**：ユーザー向けの影響がない変更
- **開発者ツール**：ビルドプロセス、CI/CD、または開発環境の変更
- **ドキュメント**：機能に影響しない更新

### デフォルトの決定ルール
**疑わしい場合は、ユーザーストーリーを含め、明確化の質問をしてください。** 適切な明確化を伴う包括的なストーリーを作成するオーバーヘッドは、通常、以下の利点によって相殺されます：
- より明確な要件理解
- より良いチーム整合性
- 改善されたテスト基準
- 強化された関係者コミュニケーション
- 実装リスクの削減
- 開発中のコストのかかる変更の削減
- より良いユーザーエクスペリエンスの成果

---

# パート1：計画

## ステップ1：ユーザーストーリーの必要性を検証（必須）

**重要**：ユーザーストーリーを進める前に、この評価を実行：

### 評価プロセス
1. **要求コンテキストを分析**：
   - 元のユーザー要求と要件を確認
   - ユーザー向けと内部のみの変更を識別
   - 作業の複雑さとスコープを評価
   - ビジネス関係者の関与を評価

2. **評価基準を適用**：
   - 高優先度の指標に対してチェック（常に実行）
   - 中優先度の要因を評価（複雑さに基づく決定）
   - これがスキップすべきシンプルなケースではないことを確認

3. **評価決定を文書化**：
   - `aidlc-docs/inception/plans/user-stories-assessment.md`を作成
   - この要求に対してユーザーストーリーが価値がある理由を含める
   - 適用される具体的な評価基準を参照
   - 期待される利点を説明（明確さ、テスト、関係者の整合性）

4. **正当化された場合のみ進む**：
   - ユーザーストーリーはプロジェクトに明確な価値を追加する必要がある
   - 評価は具体的な利点がオーバーヘッドを上回ることを示す必要がある
   - 決定はプロジェクト関係者に対して弁護可能であるべき

### 評価ドキュメントテンプレート
```markdown
# ユーザーストーリー評価

## 要求分析
- **元の要求**：[簡単なサマリー]
- **ユーザーへの影響**：[直接/間接/なし]
- **複雑さレベル**：[シンプル/中程度/複雑]
- **関係者**：[関係する当事者のリスト]

## 満たされた評価基準
- [ ] 高優先度：[適用可能な基準をリスト]
- [ ] 中優先度：[複雑さの正当化を含む適用可能な基準をリスト]
- [ ] 利点：[ユーザーストーリーから期待される価値]

## 決定
**ユーザーストーリーを実行**：[はい/いいえ]
**理由**：[詳細な正当化]

## 期待される成果
- [ユーザーストーリーが提供する具体的な利点をリスト]
- [ストーリーがプロジェクトの成功をどのように改善するか]
```

## ステップ2：ストーリー計画を作成
- プロダクトオーナーの役割を担う
- ストーリー開発のステップバイステップ実行チェックリストを含む包括的な計画を生成
- 各ステップとサブステップにチェックボックス[]を付ける
- 要件をユーザーストーリーに変換する方法論とアプローチに焦点を当てる

## ステップ3：コンテキストに適した質問を生成
**指示**：要件とコンテキストを徹底的に分析して、ストーリーの品質とチーム理解を向上させる明確化が必要なすべての領域を識別します。包括的なユーザーストーリー開発を確保するために、質問に積極的に取り組んでください。

**重要**：ストーリーの品質に影響する可能性のある曖昧さや欠落している詳細がある場合は、質問をすることをデフォルトにします。質問が多すぎることは、不完全または不明確なストーリーを作成することよりも良いです。

**質問フォーマットルールについては、`common/question-format-guide.md`を参照してください**

- [Answer]:タグ形式を使用して質問を埋め込む
- すべての曖昧さ、欠落している情報、または明確化が必要な領域に焦点を当てる
- ユーザー入力がストーリー作成の決定を改善する場所で質問を生成
- **疑わしい場合は質問をする** - 過信は貧弱なストーリーにつながる

**評価する質問カテゴリ**（すべてのカテゴリを検討）：
- **ユーザーペルソナ** - ユーザータイプ、役割、特性、動機について尋ねる
- **ストーリーの粒度** - 適切な詳細レベル、ストーリーサイズ、分解アプローチについて尋ねる
- **ストーリー形式** - 形式の好み、テンプレートの使用、ドキュメント標準について尋ねる
- **分解アプローチ** - 組織方法、優先順位付け、グループ化戦略について尋ねる
- **受け入れ基準** - 詳細レベル、形式、テストアプローチ、検証方法について尋ねる
- **ユーザージャーニー** - ユーザーワークフロー、インタラクションパターン、エクスペリエンスフローについて尋ねる
- **ビジネスコンテキスト** - ビジネス目標、成功指標、関係者のニーズについて尋ねる
- **技術的制約** - 技術的制限、統合要件、システム境界について尋ねる

## ステップ4：計画に必須のストーリー成果物を含める
- **常に**ストーリー計画にこれらの必須成果物を含める：
  - [ ] INVEST基準に従ったユーザーストーリーを含むstories.mdを生成
  - [ ] ユーザーアーキタイプと特性を含むpersonas.mdを生成
  - [ ] ストーリーが独立、交渉可能、価値がある、見積もり可能、小さい、テスト可能であることを確認
  - [ ] 各ストーリーの受け入れ基準を含める
  - [ ] ペルソナを関連するユーザーストーリーにマッピング

## ステップ5：ストーリーオプションを提示
- 計画ドキュメントにストーリー分解のための異なるアプローチを含める：
  - **ユーザージャーニーベース**：ストーリーがユーザーワークフローとインタラクションに従う
  - **機能ベース**：ストーリーがシステム機能と能力を中心に組織される
  - **ペルソナベース**：ストーリーが異なるユーザータイプとそのニーズでグループ化される
  - **ドメインベース**：ストーリーがビジネスドメインまたはコンテキストを中心に組織される
  - **エピックベース**：ストーリーがサブストーリーを持つ階層的なエピックとして構造化される
- 各アプローチのトレードオフと利点を説明
- 明確な決定基準を持つハイブリッドアプローチを許可

## ステップ6：ストーリー計画を保存
- 埋め込まれた質問を含む完全なストーリー計画を`aidlc-docs/inception/plans/`ディレクトリに保存
- ファイル名：`story-generation-plan.md`
- ユーザー入力のためのすべての[Answer]:タグを含める
- 計画が包括的で、ストーリー開発のすべての側面をカバーしていることを確認

## ステップ7：ユーザー入力を要求
- ユーザーにストーリー計画ドキュメント内ですべての[Answer]:タグを直接記入するよう依頼
- 監査証跡と決定ドキュメントの重要性を強調
- [Answer]:タグの記入方法について明確な指示を提供
- 進む前にすべての質問に回答する必要があることを説明

## ステップ8：回答を収集
- ユーザーが[Answer]:タグを使用してドキュメント内のすべての質問に回答するのを待つ
- すべての[Answer]:タグが完了するまで進まない
- ドキュメントを確認して、[Answer]:タグが空白のままになっていないことを確認

## ステップ9：回答を分析（必須）
進む前に、すべてのユーザーの回答を以下について慎重に確認する必要があります：
- **曖昧または曖昧な応答**：「混合」、「中間」、「確信がない」、「依存する」、「多分」、「おそらく」
- **未定義の基準または用語**：明確な定義のない概念への参照
- **矛盾する回答**：互いに矛盾する応答
- **欠落している生成の詳細**：実装のための具体的なガイダンスを欠く回答
- **オプションを組み合わせる回答**：明確な決定ルールなしで異なるアプローチをマージする応答
- **不完全な説明**：外部要因を参照しながらそれらを定義しない回答
- **推測ベースの応答**：明示的に述べられていない知識を仮定する回答

## ステップ10：必須のフォローアップ質問
ステップ9の分析で曖昧な回答が明らかになった場合、以下を行う必要があります：
- [Answer]:タグを使用して別の明確化質問ファイルを作成
- すべての曖昧さが完全に解決されるまで承認に進まない
- **重要**：徹底的に - すべての不明確な応答にフォローアップ質問をする
- 必要なフォローアップの例：
  - 「あなたは『AとBの混合』と言及しました - AとBのどちらを使用するかを決定する具体的な基準は何ですか？」
  - 「あなたは『AとBの中間』と言いました - 正確な中間アプローチを定義できますか？」
  - 「あなたは『確信がない』と示しました - 決定するのに役立つ追加情報は何ですか？」
  - 「あなたは『複雑さに依存する』と言及しました - 複雑さのレベルと閾値をどのように定義しますか？」
  - 「あなたは『ハイブリッドアプローチ』を選択しました - 各メソッドをいつ使用するかの具体的なルールは何ですか？」
  - 「あなたは『おそらくX』と言いました - 確実にXであるか確実にXでないかを決定する要因は何ですか？」
  - 「あなたは『標準的な慣行』と言及しました - その標準的な慣行を定義できますか？」

## ステップ11：実装の詳細を避ける
- ストーリー作成方法論に焦点を当て、優先順位付けや開発タスクには焦点を当てない
- この段階では技術的な生成について議論しない
- 開発タイムラインやスプリント計画の作成を避ける
- ストーリー構造と形式の決定に焦点を維持

## ステップ12：承認プロンプトを記録
- 承認を求める前に、タイムスタンプ付きで`aidlc-docs/audit.md`にプロンプトを記録
- 完全な承認プロンプトテキストを含める
- ISO 8601タイムスタンプ形式を使用

## ステップ13：計画の明示的な承認を待つ
- ユーザーがストーリーアプローチを明示的に承認するまで進まない
- 承認は明確で曖昧さがない必要がある
- ユーザーが変更を要求した場合は、計画を更新して承認プロセスを繰り返す

## ステップ14：承認応答を記録
- タイムスタンプ付きでユーザーの承認応答を`aidlc-docs/audit.md`に記録
- 正確なユーザー応答テキストを含める
- 承認ステータスを明確にマーク

---

# パート2：生成

## ステップ15：ストーリー生成計画を読み込む
- [ ] `aidlc-docs/inception/plans/story-generation-plan.md`から完全なストーリー計画を読み取る
- [ ] 次の未完了ステップ（最初の[ ]チェックボックス）を識別
- [ ] そのステップのコンテキストと要件を読み込む

## ステップ16：現在のステップを実行
- [ ] 現在のステップが説明していることを正確に実行
- [ ] 計画に指定されているとおりにストーリー成果物を生成
- [ ] 計画から承認された方法論と形式に従う
- [ ] 計画で指定されたストーリー分解アプローチを使用

## ステップ17：進捗を更新
- [ ] ストーリー生成計画で完了したステップを[x]としてマーク
- [ ] `aidlc-docs/aidlc-state.md`の現在のステータスを更新
- [ ] 生成されたすべての成果物を保存

## ステップ18：生成を続行または完了
- [ ] さらにステップが残っている場合は、ステップ14に戻る
- [ ] すべてのステップが完了した場合は、ストーリーが次のステージの準備ができていることを確認
- [ ] すべての必須成果物が生成されていることを確認

## ステップ19：承認プロンプトを記録
- 承認を求める前に、タイムスタンプ付きで`aidlc-docs/audit.md`にプロンプトを記録
- 完全な承認プロンプトテキストを含める
- ISO 8601タイムスタンプ形式を使用

## ステップ20：完了メッセージを提示
- この構造で完了メッセージを提示：
     1. **完了アナウンス**（必須）：常にこれで始める：

```markdown
# 📚 ユーザーストーリー完了
```

     2. **AIサマリー**（オプション）：生成されたストーリーの構造化された箇条書きサマリーを提供
        - 形式：「ユーザーストーリー生成により[説明]が作成されました：」
        - 生成された主要なペルソナをリスト（箇条書き）
        - カウントと組織を持つ作成されたユーザーストーリーをリスト
        - ストーリー構造とコンプライアンスを言及（INVEST基準、受け入れ基準）
        - ワークフロー指示を含めない（「確認してください」、「お知らせください」、「次のフェーズに進む」、「進む前に」）
        - 事実的でコンテンツに焦点を当てる
     3. **フォーマットされたワークフローメッセージ**（必須）：常にこの正確な形式で終わる：

```markdown
> **📋 <u>**確認が必要：**</u>**  
> 以下のユーザーストーリーとペルソナを確認してください：`aidlc-docs/inception/user-stories/stories.md`および`aidlc-docs/inception/user-stories/personas.md`



> **🚀 <u>**次は何ですか？**</u>**
>
> **以下を行うことができます：**
>
> 🔧 **変更を要求** - 確認に基づいてストーリーまたはペルソナへの変更を依頼
> ✅ **承認して続行** - ユーザーストーリーを承認して**ワークフロー計画**に進む

---
```

## ステップ21：生成されたストーリーの明示的な承認を待つ
- ユーザーが生成されたストーリーを明示的に承認するまで進まない
- 承認は明確で曖昧さがない必要がある
- ユーザーが変更を要求した場合は、ストーリーを更新して承認プロセスを繰り返す

## ステップ22：承認応答を記録
- タイムスタンプ付きでユーザーの承認応答を`aidlc-docs/audit.md`に記録
- 正確なユーザー応答テキストを含める
- 承認ステータスを明確にマーク

## ステップ23：進捗を更新
- `aidlc-state.md`でユーザーストーリーステージを完了としてマーク
- 「現在のステータス」セクションを更新
- 次のステージへの移行を準備

---

# 重要なルール

## 計画フェーズのルール
- **コンテキストに適した質問**：この特定のコンテキストに関連する質問のみを行う
- **必須の回答分析**：進む前に常に曖昧さについて回答を分析
- **曖昧さを持って進まない**：生成前にすべての曖昧な回答を解決する必要がある
- **明示的な承認が必要**：生成が始まる前にユーザーが計画を承認する必要がある

## 生成フェーズのルール
- **ハードコードされたロジックなし**：ストーリー生成計画に書かれていることのみを実行
- **計画に正確に従う**：ステップシーケンスから逸脱しない
- **チェックボックスを更新**：各ステップを完了した直後に[x]をマーク
- **承認された方法論を使用**：計画からのストーリーアプローチに従う
- **完了を検証**：進む前にすべてのストーリー成果物が完了していることを確認

## 完了基準
- すべての計画質問に回答し、曖昧さが解決されている
- ユーザーによってストーリー計画が明示的に承認されている
- ストーリー生成計画のすべてのステップが[x]でマークされている
- 計画に従ってすべてのストーリー成果物が生成されている（stories.md、personas.md）
- 生成されたストーリーがユーザーによって明示的に承認されている
- ストーリーが検証され、次のステージの準備ができている
