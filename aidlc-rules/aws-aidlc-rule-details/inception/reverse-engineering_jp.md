# リバースエンジニアリング

**目的**：既存のコードベースを分析し、包括的な設計成果物を生成する

**実行するタイミング**：ブラウンフィールドプロジェクトが検出された（ワークスペースで既存のコードが見つかった）

**スキップするタイミング**：グリーンフィールドプロジェクト（既存のコードがない）

**再実行の動作**：成果物が存在する場合でも、ブラウンフィールドプロジェクトが検出されたときは常に再実行します。これにより、成果物が現在のコード状態を反映することが保証されます

## ステップ1：マルチパッケージ検出

### 1.1 ワークスペースをスキャン
- すべてのパッケージ（言及されたものだけではない）
- 設定ファイルを介したパッケージの関係
- パッケージタイプ：アプリケーション、CDK/インフラストラクチャ、モデル、クライアント、テスト

### 1.2 ビジネスコンテキストを理解
- システムが全体的に実装しているコアビジネス
- すべてのパッケージのビジネス概要
- システムに実装されているビジネストランザクションのリスト

### 1.3 インフラストラクチャ検出
- CDKパッケージ（CDK依存関係を持つpackage.json）
- Terraform（.tfファイル）
- CloudFormation（.yaml/.jsonテンプレート）
- デプロイメントスクリプト

### 1.4 ビルドシステム検出
- ビルドシステム：Brazil、Maven、Gradle、npm
- ビルドシステム宣言のための設定ファイル
- パッケージ間のビルド依存関係

### 1.5 サービスアーキテクチャ検出
- Lambda関数（ハンドラー、トリガー）
- コンテナサービス（Docker/ECS設定）
- API定義（Smithyモデル、OpenAPI仕様）
- データストア（DynamoDB、S3など）

### 1.6 コード品質分析
- プログラミング言語とフレームワーク
- テストカバレッジの指標
- リンティング設定
- CI/CDパイプライン

## ステップ1：ビジネス概要ドキュメントを生成

`aidlc-docs/inception/reverse-engineering/business-overview.md`を作成：

```markdown
# ビジネス概要

## ビジネスコンテキスト図
[ビジネスコンテキストを示すMermaid図]

## ビジネス説明
- **ビジネス説明**：[システムが行うことの全体的なビジネス説明]
- **ビジネストランザクション**：[システムが実装するビジネストランザクションのリストとその説明]
- **ビジネス辞書**：[システムが従うビジネス辞書用語とその意味]

## コンポーネントレベルのビジネス説明
### [パッケージ/コンポーネント名]
- **目的**：[ビジネスの観点から何を行うか]
- **責任**：[主要な責任]
```

## ステップ2：アーキテクチャドキュメントを生成

`aidlc-docs/inception/reverse-engineering/architecture.md`を作成：

```markdown
# システムアーキテクチャ

## システム概要
[システムの高レベルな説明]

## アーキテクチャ図
[すべてのパッケージ、サービス、データストア、関係を示すMermaid図]

## コンポーネントの説明
### [パッケージ/コンポーネント名]
- **目的**：[何を行うか]
- **責任**：[主要な責任]
- **依存関係**：[何に依存するか]
- **タイプ**：[アプリケーション/インフラストラクチャ/モデル/クライアント/テスト]

## データフロー
[主要なワークフローのMermaidシーケンス図]

## 統合ポイント
- **外部API**：[目的を持つリスト]
- **データベース**：[目的を持つリスト]
- **サードパーティサービス**：[目的を持つリスト]

## インフラストラクチャコンポーネント
- **CDKスタック**：[目的を持つリスト]
- **デプロイメントモデル**：[説明]
- **ネットワーキング**：[VPC、サブネット、セキュリティグループ]
```

## ステップ3：コード構造ドキュメントを生成

`aidlc-docs/inception/reverse-engineering/code-structure.md`を作成：

```markdown
# コード構造

## ビルドシステム
- **タイプ**：[Maven/Gradle/npm/Brazil]
- **設定**：[主要なビルドファイルと設定]

## 主要なクラス/モジュール
[Mermaidクラス図またはモジュール階層]

### 既存ファイルインベントリ
[すべてのソースファイルとその目的をリスト - これらはブラウンフィールドプロジェクトでの変更候補です]

**例の形式**：
- `[path/to/file]` - [目的/責任]

## 設計パターン
### [パターン名]
- **場所**：[使用されている場所]
- **目的**：[使用される理由]
- **実装**：[どのように実装されているか]

## 重要な依存関係
### [依存関係名]
- **バージョン**：[バージョン番号]
- **使用法**：[どこでどのように使用されているか]
- **目的**：[なぜ必要か]
```

## ステップ4：APIドキュメントを生成

`aidlc-docs/inception/reverse-engineering/api-documentation.md`を作成：

```markdown
# APIドキュメント

## REST API
### [エンドポイント名]
- **メソッド**：[GET/POST/PUT/DELETE]
- **パス**：[/api/path]
- **目的**：[何を行うか]
- **リクエスト**：[リクエスト形式]
- **レスポンス**：[レスポンス形式]

## 内部API
### [インターフェース/クラス名]
- **メソッド**：[署名を持つリスト]
- **パラメーター**：[パラメーター説明]
- **戻り値の型**：[戻り値の型の説明]

## データモデル
### [モデル名]
- **フィールド**：[フィールドの説明]
- **関係**：[関連するモデル]
- **検証**：[検証ルール]
```

## ステップ5：コンポーネントインベントリを生成

`aidlc-docs/inception/reverse-engineering/component-inventory.md`を作成：

```markdown
# コンポーネントインベントリ

## アプリケーションパッケージ
- [パッケージ名] - [目的]

## インフラストラクチャパッケージ
- [パッケージ名] - [CDK/Terraform] - [目的]

## 共有パッケージ
- [パッケージ名] - [モデル/ユーティリティ/クライアント] - [目的]

## テストパッケージ
- [パッケージ名] - [統合/負荷/ユニット] - [目的]

## 合計数
- **合計パッケージ**：[数]
- **アプリケーション**：[数]
- **インフラストラクチャ**：[数]
- **共有**：[数]
- **テスト**：[数]
```

## ステップ6：テクノロジースタックドキュメントを生成

`aidlc-docs/inception/reverse-engineering/technology-stack.md`を作成：

```markdown
# テクノロジースタック

## プログラミング言語
- [言語] - [バージョン] - [使用法]

## フレームワーク
- [フレームワーク] - [バージョン] - [目的]

## インフラストラクチャ
- [サービス] - [目的]

## ビルドツール
- [ツール] - [バージョン] - [目的]

## テストツール
- [ツール] - [バージョン] - [目的]
```

## ステップ7：依存関係ドキュメントを生成

`aidlc-docs/inception/reverse-engineering/dependencies.md`を作成：

```markdown
# 依存関係

## 内部依存関係
[パッケージ依存関係を示すMermaid図]

### [パッケージA]が[パッケージB]に依存
- **タイプ**：[コンパイル/ランタイム/テスト]
- **理由**：[依存関係が存在する理由]

## 外部依存関係
### [依存関係名]
- **バージョン**：[バージョン]
- **目的**：[なぜ使用されるか]
- **ライセンス**：[ライセンスタイプ]
```

## ステップ8：コード品質評価を生成

`aidlc-docs/inception/reverse-engineering/code-quality-assessment.md`を作成：

```markdown
# コード品質評価

## テストカバレッジ
- **全体**：[パーセンテージまたは良好/普通/不良/なし]
- **ユニットテスト**：[ステータス]
- **統合テスト**：[ステータス]

## コード品質の指標
- **リンティング**：[設定済み/未設定]
- **コードスタイル**：[一貫性あり/一貫性なし]
- **ドキュメント**：[良好/普通/不良]

## 技術的負債
- [問題の説明と場所]

## パターンとアンチパターン
- **良いパターン**：[リスト]
- **アンチパターン**：[場所を持つリスト]
```

## ステップ9：タイムスタンプファイルを作成

`aidlc-docs/inception/reverse-engineering/reverse-engineering-timestamp.md`を作成：

```markdown
# リバースエンジニアリングメタデータ

**分析日**：[ISOタイムスタンプ]
**分析者**：AI-DLC
**ワークスペース**：[ワークスペースパス]
**分析された合計ファイル数**：[数]

## 生成された成果物
- [x] architecture.md
- [x] code-structure.md
- [x] api-documentation.md
- [x] component-inventory.md
- [x] technology-stack.md
- [x] dependencies.md
- [x] code-quality-assessment.md
```

## ステップ10：状態追跡を更新

`aidlc-docs/aidlc-state.md`を更新：

```markdown
## リバースエンジニアリングのステータス
- [x] リバースエンジニアリング - [timestamp]に完了
- **成果物の場所**：aidlc-docs/inception/reverse-engineering/
```

## ステップ11：ユーザーに完了メッセージを提示

```markdown
# 🔍 リバースエンジニアリング完了

[分析からの主要な調査結果のAI生成サマリー（箇条書き形式）]

> **📋 <u>**確認が必要：**</u>**  
> 以下のリバースエンジニアリング成果物を確認してください：`aidlc-docs/inception/reverse-engineering/`

> **🚀 <u>**次は何ですか？**</u>**
>
> **以下を行うことができます：**
>
> 🔧 **変更を要求** - 必要に応じてリバースエンジニアリング分析への変更を依頼
> ✅ **承認して続行** - 分析を承認して**要件分析**に進む
```

## ステップ12：ユーザーの承認を待つ

- **必須**：ユーザーが明示的に承認するまで進まない
- **必須**：ユーザーの応答を完全な生の入力でaudit.mdに記録
