# ユニット生成 - 詳細ステップ

## 概要
このステージは、システムを管理可能な作業単位に分解します。2つの統合されたパートで構成されています：
- **パート1 - 計画**：質問を含む分解計画を作成し、回答を収集し、曖昧さを分析し、承認を取得
- **パート2 - 生成**：承認された計画を実行してユニット成果物を生成

**定義**：作業単位は、開発目的のためのストーリーの論理的なグループ化です。マイクロサービスの場合、各ユニットは独立してデプロイ可能なサービスになります。モノリスの場合、単一のユニットは論理的なモジュールを持つアプリケーション全体を表します。

**用語**：独立してデプロイ可能なコンポーネントには「サービス」、サービス内の論理的なグループには「モジュール」、計画コンテキストには「作業単位」を使用します。

## 前提条件
- コンテキスト評価が完了している必要がある
- 要件評価が推奨される（機能的なスコープを提供）
- ストーリー開発が推奨される（ストーリーがユニットにマッピングされる）
- アプリケーション設計フェーズが必須（コンポーネント、メソッド、サービスを決定）
- 実行計画が設計フェーズを実行すべきことを示す必要がある

---

# パート1：計画

## ステップ1：作業単位計画を作成
- システムを作業単位に分解するためのチェックボックス[]を含む計画を生成
- システムを管理可能な開発単位に分解することに焦点を当てる
- 各ステップとサブステップにチェックボックス[]を付ける

## ステップ2：計画に必須のユニット成果物を含める
**常に**ユニット計画にこれらの必須成果物を含める：
- [ ] ユニット定義と責任を含む`aidlc-docs/inception/application-design/unit-of-work.md`を生成
- [ ] 依存関係マトリックスを含む`aidlc-docs/inception/application-design/unit-of-work-dependency.md`を生成
- [ ] ストーリーをユニットにマッピングする`aidlc-docs/inception/application-design/unit-of-work-story-map.md`を生成
- [ ] **グリーンフィールドのみ**：`unit-of-work.md`にコード組織戦略を文書化（構造パターンについてはcode-generation.mdを参照）
- [ ] ユニットの境界と依存関係を検証
- [ ] すべてのストーリーがユニットに割り当てられていることを確認

## ステップ3：コンテキストに適した質問を生成
**指示**：要件、ストーリー、アプリケーション設計を分析して、この特定の分解問題に関連する質問のみを生成します。以下のカテゴリをインスピレーションとして使用し、必須のチェックリストとしては使用しません。該当しない場合はカテゴリ全体をスキップします。

- [Answer]:タグ形式を使用して質問を埋め込む
- このコンテキストに特有の曖昧さと欠落している情報に焦点を当てる
- 意思決定にユーザー入力が必要な場所でのみ質問を生成

**質問カテゴリの例**（必要に応じて適応）：
- **ストーリーのグループ化** - 複数のストーリーが存在し、グループ化戦略が不明確な場合のみ
- **依存関係** - 複数のユニットが可能性が高く、統合アプローチが曖昧な場合のみ
- **チームの整合性** - チーム構造または所有権が不明確な場合のみ
- **技術的考慮事項** - スケーラビリティ/デプロイメント要件がユニット間で異なる場合のみ
- **ビジネスドメイン** - ドメイン境界または境界付けられたコンテキストが不明確な場合のみ
- **コード組織（グリーンフィールドマルチユニットのみ）** - デプロイメントモデルとディレクトリ構造の好みについて尋ねる

## ステップ4：UOW計画を保存
- `aidlc-docs/inception/plans/unit-of-work-plan.md`として保存
- ユーザー入力のためのすべての[Answer]:タグを含める
- 計画がシステム分解のすべての側面をカバーしていることを確認

## ステップ5：ユーザー入力を要求
- ユーザーに計画ドキュメント内で直接[Answer]:タグを記入するよう依頼
- 分解決定の重要性を強調
- [Answer]:タグの完了について明確な指示を提供

## ステップ6：回答を収集
- ユーザーが[Answer]:タグを使用してすべての質問に回答するのを待つ
- すべての[Answer]:タグが完了するまで進まない
- ドキュメントを確認して、[Answer]:タグが空白のままになっていないことを確認

## ステップ7：回答を分析（必須）
進む前に、すべてのユーザーの回答を以下について慎重に確認する必要があります：
- **曖昧または曖昧な応答**：「混合」、「中間」、「確信がない」、「依存する」
- **未定義の基準または用語**：明確な定義のない概念への参照
- **矛盾する回答**：互いに矛盾する応答
- **欠落している生成の詳細**：具体的なガイダンスを欠く回答
- **オプションを組み合わせる回答**：明確な決定ルールなしで異なるアプローチをマージする応答

## ステップ8：必須のフォローアップ質問
ステップ7の分析で曖昧な回答が明らかになった場合、以下を行う必要があります：
- [Answer]:タグを使用して計画ドキュメントに具体的なフォローアップ質問を追加
- すべての曖昧さが解決されるまで承認に進まない
- 必要なフォローアップの例：
  - 「あなたは『AとBの混合』と言及しました - AとBのどちらを使用するかを決定する具体的な基準は何ですか？」
  - 「あなたは『AとBの中間』と言いました - 正確な中間アプローチを定義できますか？」
  - 「あなたは『確信がない』と示しました - 決定するのに役立つ追加情報は何ですか？」
  - 「あなたは『複雑さに依存する』と言及しました - 複雑さのレベルをどのように定義しますか？」

## ステップ9：承認を要求
- 質問する：「**作業単位計画が完了しました。aidlc-docs/inception/plans/unit-of-work-plan.mdの計画を確認してください。生成に進む準備はできていますか？**」
- ユーザーが確認するまで進まない

## ステップ10：承認を記録
- タイムスタンプ付きでaudit.mdにプロンプトと応答を記録
- ISO 8601タイムスタンプ形式を使用
- 完全な承認プロンプトテキストを含める

## ステップ11：進捗を更新
- aidlc-state.mdでユニット計画を完了としてマーク
- 「現在のステータス」セクションを更新
- ユニット生成への移行を準備

---

# パート2：生成

## ステップ12：作業単位計画を読み込む
- [ ] `aidlc-docs/inception/plans/unit-of-work-plan.md`から完全な計画を読み取る
- [ ] 次の未完了ステップ（最初の[ ]チェックボックス）を識別
- [ ] そのステップのコンテキストと要件を読み込む

## ステップ13：現在のステップを実行
- [ ] 現在のステップが説明していることを正確に実行
- [ ] 計画に指定されているとおりにユニット成果物を生成
- [ ] 計画から承認された分解アプローチに従う
- [ ] 計画で指定された基準と境界を使用

## ステップ14：進捗を更新
- [ ] 作業単位計画で完了したステップを[x]としてマーク
- [ ] `aidlc-docs/aidlc-state.md`の現在のステータスを更新
- [ ] 生成されたすべての成果物を保存

## ステップ15：続行または完了
- [ ] さらにステップが残っている場合は、ステップ12に戻る
- [ ] すべてのステップが完了した場合は、ユニットが設計ステージの準備ができていることを確認
- [ ] ユニット生成ステージを完了としてマーク

## ステップ16：完了メッセージを提示

```markdown
# 🔧 ユニット生成完了

[作成されたユニットと分解のAI生成サマリー（箇条書き）]

> **📋 <u>**確認が必要：**</u>**  
> 以下のユニット生成成果物を確認してください：`aidlc-docs/inception/application-design/`

> **🚀 <u>**次は何ですか？**</u>**
>
> **以下を行うことができます：**
>
> 🔧 **変更を要求** - 必要に応じてユニット生成への変更を依頼
> ✅ **承認して続行** - ユニットを承認して**CONSTRUCTIONフェーズ**に進む
```

## ステップ17：明示的な承認を待つ
- ユーザーがユニット生成を明示的に承認するまで進まない
- 承認は明確で曖昧さがない必要がある
- ユーザーが変更を要求した場合は、ユニットを更新して承認プロセスを繰り返す

## ステップ18：承認応答を記録
- タイムスタンプ付きでユーザーの承認応答を`aidlc-docs/audit.md`に記録
- 正確なユーザー応答テキストを含める
- 承認ステータスを明確にマーク

## ステップ19：進捗を更新
- `aidlc-docs/aidlc-state.md`でユニット生成ステージを完了としてマーク
- 「現在のステータス」セクションを更新
- CONSTRUCTIONフェーズへの移行を準備

---

## 重要なルール

### 計画フェーズのルール
- コンテキストに関連する質問のみを生成
- すべての質問に[Answer]:タグ形式を使用
- 進む前にすべての回答を曖昧さについて分析
- フォローアップ質問ですべての曖昧さを解決
- 生成前に明示的なユーザー承認を取得

### 生成フェーズのルール
- **ハードコードされたロジックなし**：作業単位計画に書かれていることのみを実行
- **計画に正確に従う**：ステップシーケンスから逸脱しない
- **チェックボックスを更新**：各ステップを完了した直後に[x]をマーク
- **承認されたアプローチを使用**：計画からの分解方法論に従う
- **完了を検証**：進む前にすべてのユニット成果物が完了していることを確認

## 完了基準
- すべての計画質問に回答し、曖昧さが解決されている
- 計画についてユーザーの承認を取得
- 作業単位計画のすべてのステップが[x]でマークされている
- 計画に従ってすべてのユニット成果物が生成されている：
  - ユニット定義を持つ`unit-of-work.md`
  - 依存関係マトリックスを持つ`unit-of-work-dependency.md`
  - ストーリーマッピングを持つ`unit-of-work-story-map.md`
- ユニットが検証され、ユニットごとの設計ステージの準備ができている
