# 要件分析（適応型）

**役割を担う**：プロダクトオーナー

**適応型フェーズ**：常に実行されます。詳細レベルは問題の複雑さに適応します。

**適応的な深度の説明については、[depth-levels.md](../common/depth-levels.md)を参照してください**

## 前提条件
- ワークスペース検出が完了している必要がある
- リバースエンジニアリングが完了している必要がある（ブラウンフィールドの場合）

## 実行ステップ

### ステップ1：リバースエンジニアリングのコンテキストを読み込む（利用可能な場合）

**ブラウンフィールドプロジェクトの場合**：
- `aidlc-docs/inception/reverse-engineering/architecture.md`を読み込む
- `aidlc-docs/inception/reverse-engineering/component-inventory.md`を読み込む
- `aidlc-docs/inception/reverse-engineering/technology-stack.md`を読み込む
- 要求を分析する際に既存のシステムを理解するためにこれらを使用

### ステップ2：ユーザー要求を分析（意図分析）

#### 2.1 要求の明確さ
- **明確**：具体的、明確に定義された、実行可能
- **曖昧**：一般的、曖昧、明確化が必要
- **不完全**：重要な情報が欠落

#### 2.2 要求タイプ
- **新機能**：新しい機能の追加
- **バグ修正**：既存の問題の修正
- **リファクタリング**：コード構造の改善
- **アップグレード**：依存関係またはフレームワークの更新
- **移行**：異なる技術への移行
- **機能強化**：既存機能の改善
- **新規プロジェクト**：ゼロから開始

#### 2.3 初期スコープの見積もり
- **単一ファイル**：1つのファイルへの変更
- **単一コンポーネント**：1つのコンポーネント/パッケージへの変更
- **複数コンポーネント**：複数のコンポーネントにわたる変更
- **システム全体**：システム全体に影響する変更
- **クロスシステム**：複数のシステムに影響する変更

#### 2.4 初期複雑さの見積もり
- **些細**：シンプルで単純な変更
- **シンプル**：明確な実装パス
- **中程度**：いくつかの複雑さ、複数の考慮事項
- **複雑**：重要な複雑さ、多くの考慮事項

### ステップ3：要件の深度を決定

**要求分析に基づいて深度を決定：**

**最小限の深度** - 次の場合に使用：
- 要求が明確でシンプル
- 詳細な要件は不要
- 基本的な理解を文書化するだけ

**標準深度** - 次の場合に使用：
- 要求に明確化が必要
- 機能要件と非機能要件が必要
- 通常の複雑さ

**包括的な深度** - 次の場合に使用：
- 複数の関係者を持つ複雑なプロジェクト
- 高リスクまたは重要なシステム
- トレーサビリティを持つ詳細な要件が必要

### ステップ4：現在の要件を評価

ユーザーが提供したものを分析：
   - 意図ステートメントまたは説明（すでにaudit.mdに記録）
   - 既存の要件ドキュメント（言及されている場合はワークスペースを検索）
   - 貼り付けられたコンテンツまたはファイル参照
   - 非Markdownドキュメントをmarkdown形式に変換

### ステップ5：徹底的な完全性分析

**重要**：包括的な分析を使用して要件の完全性を評価します。曖昧さや欠落している詳細がある場合は、質問をすることをデフォルトにします。

**必須**：これらの領域をすべて評価し、不明確なものについては質問をします：
- **機能要件**：コア機能、ユーザーインタラクション、システムの動作
- **非機能要件**：パフォーマンス、セキュリティ、スケーラビリティ、ユーザビリティ
- **ユーザーシナリオ**：ユースケース、ユーザージャーニー、エッジケース、エラーシナリオ
- **ビジネスコンテキスト**：目標、制約、成功基準、関係者のニーズ
- **技術的コンテキスト**：統合ポイント、データ要件、システム境界
- **品質属性**：信頼性、保守性、テスト可能性、アクセシビリティ

**疑わしい場合は質問をする** - 不完全な要件は貧弱な実装につながります。

### ステップ6：明確化の質問を生成（積極的アプローチ）
   - 要件が例外的に明確で完全でない限り、**常に**`aidlc-docs/inception/requirements/requirement-verification-questions.md`を作成
   - 欠落している、不明確、または曖昧な領域について質問をする
   - 機能要件、非機能要件、ユーザーシナリオ、ビジネスコンテキストに焦点を当てる
   - ユーザーに質問ドキュメント内ですべての[Answer]:タグを直接記入するよう要求
   - 回答に多肢選択オプションを提示する場合：
     - オプションにA、B、C、Dなどのラベルを付ける
     - オプションが相互に排他的で重複しないことを確認
     - 常にカスタム応答のオプションを含める：「X) その他（以下の[Answer]:タグの後に説明してください）」
   - ドキュメント内でユーザーの回答を待つ
   - **必須**：すべての回答を曖昧さについて分析し、必要に応じてフォローアップの質問を作成
   - **必須**：すべての曖昧さが解決されるまで、またはユーザーが明示的に続行を要求するまで質問を続ける

### ステップ7：要件ドキュメントを生成
   - `aidlc-docs/inception/requirements/requirements.md`を作成
   - 上部に意図分析のサマリーを含める：
     - ユーザー要求
     - 要求タイプ
     - スコープの見積もり
     - 複雑さの見積もり
   - 機能要件と非機能要件の両方を含める
   - 明確化の質問へのユーザーの回答を組み込む
   - 主要な要件の簡単なサマリーを提供

### ステップ8：状態追跡を更新

`aidlc-docs/aidlc-state.md`を更新：

```markdown
## ステージの進捗
### 🔵 INCEPTIONフェーズ
- [x] ワークスペース検出
- [x] リバースエンジニアリング（該当する場合）
- [x] 要件分析
```

### ステップ9：記録して進む
   - タイムスタンプ付きで`aidlc-docs/audit.md`に承認プロンプトを記録
   - この構造で完了メッセージを提示：
     1. **完了アナウンス**（必須）：常にこれで始める：

```markdown
# 🔍 要件分析完了
```

     2. **AIサマリー**（オプション）：要件の構造化された箇条書きサマリーを提供
        - 形式：「要件分析により[プロジェクトタイプ/複雑さ]が特定されました：」
        - 主要な機能要件をリスト（箇条書き）
        - 主要な非機能要件をリスト（箇条書き）
        - 関連する場合はアーキテクチャの考慮事項や技術的決定を言及
        - ワークフロー指示を含めない（「確認してください」、「お知らせください」、「次のフェーズに進む」、「進む前に」）
        - 事実的でコンテンツに焦点を当てる
     3. **フォーマットされたワークフローメッセージ**（必須）：常にこの正確な形式で終わる：

```markdown
> **📋 <u>**確認が必要：**</u>**  
> 以下の要件ドキュメントを確認してください：`aidlc-docs/inception/requirements/requirements.md`



> **🚀 <u>**次は何ですか？**</u>**
>
> **以下を行うことができます：**
>
> 🔧 **変更を要求** - 確認に基づいて必要な場合は要件への変更を依頼
> [ユーザーストーリーがスキップされる場合、このオプションを追加：]
> 📝 **ユーザーストーリーを追加** - **ユーザーストーリー**ステージを含めることを選択（プロジェクトの簡潔さに基づいて現在スキップされています）
> ✅ **承認して続行** - 要件を承認して**[ユーザーストーリー/ワークフロー計画]**に進む

---
```

**注意**：ユーザーストーリーステージがスキップされる場合にのみ「ユーザーストーリーを追加」オプションを含めます。[ユーザーストーリー/ワークフロー計画]を実際の次のステージ名に置き換えます。

   - 進行する前に明示的なユーザー承認を待つ
   - タイムスタンプ付きで承認応答を記録
   - aidlc-state.mdで要件分析ステージを完了として更新
