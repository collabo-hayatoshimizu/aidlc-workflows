# 機能設計

## 目的
**ユニットごとの詳細なビジネスロジック設計**

機能設計は以下に焦点を当てます：
- ユニットの詳細なビジネスロジックとアルゴリズム
- エンティティと関係を持つドメインモデル
- 詳細なビジネスルール、検証ロジック、制約
- 技術に依存しない設計（インフラストラクチャの懸念なし）

**注意**：これはアプリケーション設計（INCEPTIONフェーズ）からの高レベルのコンポーネント設計に基づいて構築されます

## 前提条件
- ユニット生成が完了している必要がある
- 作業単位の成果物が利用可能である必要がある
- アプリケーション設計が推奨される（高レベルのコンポーネント構造を提供）
- 実行計画が機能設計ステージを実行すべきことを示す必要がある

## 概要
ユニットの詳細なビジネスロジックを設計し、技術に依存せず、純粋にビジネス機能に焦点を当てます。

## 実行するステップ

### ステップ1：ユニットコンテキストを分析
- `aidlc-docs/inception/application-design/unit-of-work.md`からユニット定義を読み取る
- `aidlc-docs/inception/application-design/unit-of-work-story-map.md`から割り当てられたストーリーを読み取る
- ユニットの責任と境界を理解

### ステップ2：機能設計計画を作成
- 機能設計のチェックボックス[]を含む計画を生成
- ビジネスロジック、ドメインモデル、ビジネスルールに焦点を当てる
- 各ステップにチェックボックス[]を付ける

### ステップ3：コンテキストに適した質問を生成
**指示**：ユニット定義と機能設計成果物を徹底的に分析して、機能設計を改善する明確化が必要なすべての領域を識別します。包括的な理解を確保するために、質問に積極的に取り組んでください。

**重要**：機能設計の品質に影響する可能性のある曖昧さや欠落している詳細がある場合は、質問をすることをデフォルトにします。質問が多すぎることは、不正確な推測を行うことよりも良いです。

- [Answer]:タグ形式を使用して質問を埋め込む
- すべての曖昧さ、欠落している情報、または明確化が必要な領域に焦点を当てる
- ユーザー入力が機能設計の決定を改善する場所で質問を生成
- **疑わしい場合は質問をする** - 過信は貧弱な設計につながる

**検討する質問カテゴリ**（すべてのカテゴリを評価）：
- **ビジネスロジックモデリング** - コアエンティティ、ワークフロー、データ変換、ビジネスプロセスについて尋ねる
- **ドメインモデル** - ドメイン概念、エンティティ関係、データ構造、ビジネスオブジェクトについて尋ねる
- **ビジネスルール** - 決定ルール、検証ロジック、制約、ビジネスポリシーについて尋ねる
- **データフロー** - データの入力、出力、変換、永続化要件について尋ねる
- **統合ポイント** - 外部システムのインタラクション、API、データ交換について尋ねる
- **エラー処理** - エラーシナリオ、検証失敗、例外処理について尋ねる
- **ビジネスシナリオ** - エッジケース、代替フロー、複雑なビジネス状況について尋ねる

### ステップ4：計画を保存
- `aidlc-docs/construction/plans/{unit-name}-functional-design-plan.md`として保存
- ユーザー入力のためのすべての[Answer]:タグを含める

### ステップ5：回答を収集して分析
- ユーザーがすべての[Answer]:タグを完了するのを待つ
- **必須**：すべての応答を曖昧または曖昧な回答について慎重に確認
- **重要**：不明確な応答にフォローアップ質問を追加 - 曖昧さを持って進まない
- 「依存する」、「多分」、「確信がない」、「混合」、「中間」のような応答を探す
- 曖昧さが検出された場合は明確化質問ファイルを作成
- **すべての曖昧さが解決されるまで進まない**

### ステップ6：機能設計成果物を生成
- `aidlc-docs/construction/{unit-name}/functional-design/business-logic-model.md`を作成
- `aidlc-docs/construction/{unit-name}/functional-design/business-rules.md`を作成
- `aidlc-docs/construction/{unit-name}/functional-design/domain-entities.md`を作成

### ステップ7：完了メッセージを提示
- この構造で完了メッセージを提示：
     1. **完了アナウンス**（必須）：常にこれで始める：

```markdown
# 🔧 機能設計完了 - [unit-name]
```

     2. **AIサマリー**（オプション）：機能設計の構造化された箇条書きサマリーを提供
        - 形式：「機能設計により[説明]が作成されました：」
        - 主要なビジネスロジックモデルとエンティティをリスト（箇条書き）
        - 定義されたビジネスルールと検証ロジックをリスト
        - ドメインモデル構造と関係を言及
        - ワークフロー指示を含めない（「確認してください」、「お知らせください」、「次のフェーズに進む」、「進む前に」）
        - 事実的でコンテンツに焦点を当てる
     3. **フォーマットされたワークフローメッセージ**（必須）：常にこの正確な形式で終わる：

```markdown
> **📋 <u>**確認が必要：**</u>**  
> 以下の機能設計成果物を確認してください：`aidlc-docs/construction/[unit-name]/functional-design/`



> **🚀 <u>**次は何ですか？**</u>**
>
> **以下を行うことができます：**
>
> 🔧 **変更を要求** - 確認に基づいて機能設計への変更を依頼
> ✅ **次のステージに続行** - 機能設計を承認して**[next-stage-name]**に進む

---
```

### ステップ8：明示的な承認を待つ
- ユーザーが機能設計を明示的に承認するまで進まない
- 承認は明確で曖昧さがない必要がある
- ユーザーが変更を要求した場合は、設計を更新して承認プロセスを繰り返す

### ステップ9：承認を記録して進捗を更新
- タイムスタンプ付きでaudit.mdに承認を記録
- タイムスタンプ付きでユーザーの承認応答を記録
- aidlc-state.mdで機能設計ステージを完了としてマーク
