# NFR設計

## 前提条件
- ユニットのNFR要件が完了している必要がある
- NFR要件成果物が利用可能である必要がある
- 実行計画がNFR設計ステージを実行すべきことを示す必要がある

## 概要
パターンと論理コンポーネントを使用してNFR要件をユニット設計に組み込みます。

## 実行するステップ

### ステップ1：NFR要件を分析
- `aidlc-docs/construction/{unit-name}/nfr-requirements/`からNFR要件を読み取る
- スケーラビリティ、パフォーマンス、可用性、セキュリティのニーズを理解

### ステップ2：NFR設計計画を作成
- NFR設計のチェックボックス[]を含む計画を生成
- 設計パターンと論理コンポーネントに焦点を当てる
- 各ステップにチェックボックス[]を付ける

### ステップ3：コンテキストに適した質問を生成
**指示**：NFR要件を分析して、この特定のユニットのNFR設計に関連する質問のみを生成します。以下のカテゴリをインスピレーションとして使用し、必須のチェックリストとしては使用しません。該当しない場合はカテゴリ全体をスキップします。

- [Answer]:タグ形式を使用して質問を埋め込む
- このユニットに特有の曖昧さと欠落している情報に焦点を当てる
- パターンとコンポーネントの決定にユーザー入力が必要な場所でのみ質問を生成

**質問カテゴリの例**（必要に応じて適応）：
- **回復力パターン** - 耐障害性アプローチが明確化を必要とする場合のみ
- **スケーラビリティパターン** - スケーリングメカニズムが不明確な場合のみ
- **パフォーマンスパターン** - パフォーマンス最適化戦略が曖昧な場合のみ
- **セキュリティパターン** - セキュリティ実装アプローチが入力を必要とする場合のみ
- **論理コンポーネント** - インフラストラクチャコンポーネント（キュー、キャッシュなど）が明確化を必要とする場合のみ

### ステップ4：計画を保存
- `aidlc-docs/construction/plans/{unit-name}-nfr-design-plan.md`として保存
- ユーザー入力のためのすべての[Answer]:タグを含める

### ステップ5：回答を収集して分析
- ユーザーがすべての[Answer]:タグを完了するのを待つ
- 曖昧または曖昧な応答を確認
- 必要に応じてフォローアップ質問を追加

### ステップ6：NFR設計成果物を生成
- `aidlc-docs/construction/{unit-name}/nfr-design/nfr-design-patterns.md`を作成
- `aidlc-docs/construction/{unit-name}/nfr-design/logical-components.md`を作成

### ステップ7：完了メッセージを提示
- この構造で完了メッセージを提示：
     1. **完了アナウンス**（必須）：常にこれで始める：

```markdown
# 🎨 NFR設計完了 - [unit-name]
```

     2. **AIサマリー**（オプション）：NFR設計の構造化された箇条書きサマリーを提供
        - 形式：「NFR設計により[説明]が組み込まれました：」
        - 実装された主要な設計パターンをリスト（箇条書き）
        - 論理コンポーネントとインフラストラクチャ要素をリスト
        - 適用された回復力、スケーラビリティ、パフォーマンスパターンを言及
        - ワークフロー指示を含めない（「確認してください」、「お知らせください」、「次のフェーズに進む」、「進む前に」）
        - 事実的でコンテンツに焦点を当てる
     3. **フォーマットされたワークフローメッセージ**（必須）：常にこの正確な形式で終わる：

```markdown
> **📋 <u>**確認が必要：**</u>**  
> 以下のNFR設計を確認してください：`aidlc-docs/construction/[unit-name]/nfr-design/`



> **🚀 <u>**次は何ですか？**</u>**
>
> **以下を行うことができます：**
>
> 🔧 **変更を要求** - 確認に基づいてNFR設計への変更を依頼
> ✅ **次のステージに続行** - NFR設計を承認して**[next-stage-name]**に進む

---
```

### ステップ8：明示的な承認を待つ
- ユーザーがNFR設計を明示的に承認するまで進まない
- 承認は明確で曖昧さがない必要がある
- ユーザーが変更を要求した場合は、設計を更新して承認プロセスを繰り返す

### ステップ9：承認を記録して進捗を更新
- タイムスタンプ付きでaudit.mdに承認を記録
- タイムスタンプ付きでユーザーの承認応答を記録
- aidlc-state.mdでNFR設計ステージを完了としてマーク
