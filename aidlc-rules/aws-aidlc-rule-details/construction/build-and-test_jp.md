# ビルドとテスト

**目的**：すべてのユニットをビルドして包括的なテスト戦略を実行する

## 前提条件
- すべてのユニットのコード生成が完了している必要がある
- すべてのコード成果物が生成されている必要がある
- プロジェクトがビルドとテストの準備ができている

---

## ステップ1：テスト要件を分析

プロジェクトを分析して適切なテスト戦略を決定：
- **ユニットテスト**：コード生成中にユニットごとにすでに生成されている
- **統合テスト**：ユニット/サービス間のインタラクションをテスト
- **パフォーマンステスト**：負荷、ストレス、スケーラビリティテスト
- **エンドツーエンドテスト**：完全なユーザーワークフロー
- **契約テスト**：サービス間のAPI契約検証
- **セキュリティテスト**：脆弱性スキャン、侵入テスト

---

## ステップ2：ビルド指示を生成

`aidlc-docs/construction/build-and-test/build-instructions.md`を作成：

```markdown
# ビルド指示

## 前提条件
- **ビルドツール**：[ツール名とバージョン]
- **依存関係**：[必要なすべての依存関係をリスト]
- **環境変数**：[必要な環境変数をリスト]
- **システム要件**：[OS、メモリ、ディスク容量]

## ビルドステップ

### 1. 依存関係をインストール
\`\`\`bash
[依存関係をインストールするコマンド]
# 例：npm install、mvn dependency:resolve、pip install -r requirements.txt
\`\`\`

### 2. 環境を設定
\`\`\`bash
[環境をセットアップするコマンド]
# 例：変数をエクスポート、認証情報を設定
\`\`\`

### 3. すべてのユニットをビルド
\`\`\`bash
[すべてのユニットをビルドするコマンド]
# 例：mvn clean install、npm run build、brazil-build
\`\`\`

### 4. ビルドの成功を確認
- **期待される出力**：[成功したビルド出力を説明]
- **ビルド成果物**：[生成された成果物と場所をリスト]
- **一般的な警告**：[許容される警告を注記]

## トラブルシューティング

### 依存関係エラーでビルドが失敗
- **原因**：[一般的な原因]
- **解決策**：[ステップバイステップの修正]

### コンパイルエラーでビルドが失敗
- **原因**：[一般的な原因]
- **解決策**：[ステップバイステップの修正]
```

---

## ステップ3：ユニットテスト実行指示を生成

`aidlc-docs/construction/build-and-test/unit-test-instructions.md`を作成：

```markdown
# ユニットテスト実行

## ユニットテストを実行

### 1. すべてのユニットテストを実行
\`\`\`bash
[すべてのユニットテストを実行するコマンド]
# 例：mvn test、npm test、pytest tests/unit
\`\`\`

### 2. テスト結果を確認
- **期待**：[X]テストが合格、0失敗
- **テストカバレッジ**：[期待されるカバレッジパーセンテージ]
- **テストレポートの場所**：[テストレポートへのパス]

### 3. 失敗したテストを修正
テストが失敗した場合：
1. [場所]のテスト出力を確認
2. 失敗したテストケースを識別
3. コードの問題を修正
4. すべてが合格するまでテストを再実行
```

---

## ステップ4：統合テスト指示を生成

`aidlc-docs/construction/build-and-test/integration-test-instructions.md`を作成：

```markdown
# 統合テスト指示

## 目的
ユニット/サービス間のインタラクションをテストして、正しく連携していることを確認します。

## テストシナリオ

### シナリオ1：[ユニットA]→[ユニットB]統合
- **説明**：[何がテストされているか]
- **セットアップ**：[必要なテスト環境のセットアップ]
- **テストステップ**：[ステップバイステップのテスト実行]
- **期待される結果**：[何が起こるべきか]
- **クリーンアップ**：[テスト後のクリーンアップ方法]

### シナリオ2：[ユニットB]→[ユニットC]統合
[同様の構造]

## 統合テスト環境をセットアップ

### 1. 必要なサービスを起動
\`\`\`bash
[サービスを起動するコマンド]
# 例：docker-compose up、テストデータベースを起動
\`\`\`

### 2. サービスエンドポイントを設定
\`\`\`bash
[エンドポイントを設定するコマンド]
# 例：export API_URL=http://localhost:8080
\`\`\`

## 統合テストを実行

### 1. 統合テストスイートを実行
\`\`\`bash
[統合テストを実行するコマンド]
# 例：mvn integration-test、npm run test:integration
\`\`\`

### 2. サービスインタラクションを確認
- **テストシナリオ**：[主要な統合テストシナリオをリスト]
- **期待される結果**：[期待される成果を説明]
- **ログの場所**：[ログをチェックする場所]

### 3. クリーンアップ
\`\`\`bash
[テスト環境をクリーンアップするコマンド]
# 例：docker-compose down、テストサービスを停止
\`\`\`
```

---

## ステップ5：パフォーマンステスト指示を生成（該当する場合）

`aidlc-docs/construction/build-and-test/performance-test-instructions.md`を作成：

```markdown
# パフォーマンステスト指示

## 目的
負荷下でシステムのパフォーマンスを検証し、要件を満たしていることを確認します。

## パフォーマンス要件
- **応答時間**：リクエストの[Y]%で< [X]ms
- **スループット**：[X]リクエスト/秒
- **同時ユーザー**：[X]同時ユーザーをサポート
- **エラー率**：< [X]%

## パフォーマンステスト環境をセットアップ

### 1. テスト環境を準備
\`\`\`bash
[パフォーマンステストをセットアップするコマンド]
# 例：サービスをスケール、ロードバランサーを設定
\`\`\`

### 2. テストパラメーターを設定
- **テスト期間**：[X]分
- **ランプアップ時間**：[X]秒
- **仮想ユーザー**：[X]ユーザー

## パフォーマンステストを実行

### 1. 負荷テストを実行
\`\`\`bash
[負荷テストを実行するコマンド]
# 例：jmeter -n -t test.jmx、k6 run script.js
\`\`\`

### 2. ストレステストを実行
\`\`\`bash
[ストレステストを実行するコマンド]
# 例：障害まで徐々に負荷を増加
\`\`\`

### 3. パフォーマンス結果を分析
- **応答時間**：[実際対期待]
- **スループット**：[実際対期待]
- **エラー率**：[実際対期待]
- **ボトルネック**：[識別されたボトルネック]
- **結果の場所**：[パフォーマンスレポートへのパス]

## パフォーマンス最適化

パフォーマンスが要件を満たさない場合：
1. テスト結果からボトルネックを識別
2. コード/クエリ/設定を最適化
3. 改善を検証するためにテストを再実行
```

---

## ステップ6：追加のテスト指示を生成（必要に応じて）

プロジェクト要件に基づいて、追加のテスト指示ファイルを生成：

### 契約テスト（マイクロサービスの場合）
`aidlc-docs/construction/build-and-test/contract-test-instructions.md`を作成：
- サービス間のAPI契約検証
- 消費者駆動型契約テスト
- スキーマ検証

### セキュリティテスト
`aidlc-docs/construction/build-and-test/security-test-instructions.md`を作成：
- 脆弱性スキャン
- 依存関係のセキュリティチェック
- 認証/認可テスト
- 入力検証テスト

### エンドツーエンドテスト
`aidlc-docs/construction/build-and-test/e2e-test-instructions.md`を作成：
- 完全なユーザーワークフローテスト
- クロスサービスシナリオ
- UIテスト（該当する場合）

---

## ステップ7：テストサマリーを生成

`aidlc-docs/construction/build-and-test/build-and-test-summary.md`を作成：

```markdown
# ビルドとテストサマリー

## ビルドステータス
- **ビルドツール**：[ツール名]
- **ビルドステータス**：[成功/失敗]
- **ビルド成果物**：[成果物をリスト]
- **ビルド時間**：[期間]

## テスト実行サマリー

### ユニットテスト
- **合計テスト**：[X]
- **合格**：[X]
- **失敗**：[X]
- **カバレッジ**：[X]%
- **ステータス**：[合格/不合格]

### 統合テスト
- **テストシナリオ**：[X]
- **合格**：[X]
- **失敗**：[X]
- **ステータス**：[合格/不合格]

### パフォーマンステスト
- **応答時間**：[実際]（ターゲット：[期待]）
- **スループット**：[実際]（ターゲット：[期待]）
- **エラー率**：[実際]（ターゲット：[期待]）
- **ステータス**：[合格/不合格]

### 追加テスト
- **契約テスト**：[合格/不合格/N/A]
- **セキュリティテスト**：[合格/不合格/N/A]
- **E2Eテスト**：[合格/不合格/N/A]

## 全体的なステータス
- **ビルド**：[成功/失敗]
- **すべてのテスト**：[合格/不合格]
- **運用準備完了**：[はい/いいえ]

## 次のステップ
[すべて合格の場合]：デプロイメント計画のためにOperationsフェーズに進む準備ができている
[失敗がある場合]：失敗したテストに対処して再ビルド
```

---

## ステップ8：状態追跡を更新

`aidlc-docs/aidlc-state.md`を更新：
- ビルドとテストステージを完了としてマーク
- 現在のステータスを更新

---

## ステップ9：ユーザーに結果を提示

包括的なメッセージを提示：

```
「🔨 ビルドとテスト完了！

**ビルドステータス**：[成功/失敗]

**テスト結果**：
✅ ユニットテスト：[X]合格
✅ 統合テスト：[X]シナリオ合格
✅ パフォーマンステスト：[ステータス]
✅ 追加テスト：[ステータス]

**生成されたファイル**：
1. ✅ build-instructions.md
2. ✅ unit-test-instructions.md
3. ✅ integration-test-instructions.md
4. ✅ performance-test-instructions.md（該当する場合）
5. ✅ [必要に応じて追加のテストファイル]
6. ✅ build-and-test-summary.md

aidlc-docs/construction/build-and-test/build-and-test-summary.mdのサマリーを確認してください

**デプロイメント計画のためにOperationsステージに進む準備はできていますか？」」
```

---

## ステップ10：インタラクションを記録

**必須**：`aidlc-docs/audit.md`にフェーズ完了を記録：

```markdown
## ビルドとテストステージ
**タイムスタンプ**：[ISOタイムスタンプ]
**ビルドステータス**：[成功/失敗]
**テストステータス**：[合格/不合格]
**生成されたファイル**：
- build-instructions.md
- unit-test-instructions.md
- integration-test-instructions.md
- performance-test-instructions.md
- build-and-test-summary.md

---
```
