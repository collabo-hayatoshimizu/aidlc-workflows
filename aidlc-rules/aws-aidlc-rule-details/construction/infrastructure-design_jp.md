# インフラストラクチャ設計

## 前提条件
- ユニットの機能設計が完了している必要がある
- NFR設計が推奨される（マッピングする論理コンポーネントを提供）
- 実行計画がインフラストラクチャ設計ステージを実行すべきことを示す必要がある

## 概要
デプロイメント環境の実際のインフラストラクチャ選択に論理的なソフトウェアコンポーネントをマッピングします。

## 実行するステップ

### ステップ1：設計成果物を分析
- `aidlc-docs/construction/{unit-name}/functional-design/`から機能設計を読み取る
- `aidlc-docs/construction/{unit-name}/nfr-design/`からNFR設計を読み取る（存在する場合）
- インフラストラクチャを必要とする論理コンポーネントを識別

### ステップ2：インフラストラクチャ設計計画を作成
- インフラストラクチャ設計のチェックボックス[]を含む計画を生成
- 実際のサービス（AWS、Azure、GCP、オンプレミス）へのマッピングに焦点を当てる
- 各ステップにチェックボックス[]を付ける

### ステップ3：コンテキストに適した質問を生成
**指示**：機能設計とNFR設計を分析して、この特定のユニットのインフラストラクチャニーズに関連する質問のみを生成します。以下のカテゴリをインスピレーションとして使用し、必須のチェックリストとしては使用しません。該当しない場合はカテゴリ全体をスキップします。

- [Answer]:タグ形式を使用して質問を埋め込む
- このユニットに特有の曖昧さと欠落している情報に焦点を当てる
- インフラストラクチャの決定にユーザー入力が必要な場所でのみ質問を生成

**質問カテゴリの例**（必要に応じて適応）：
- **デプロイメント環境** - クラウドプロバイダーまたは環境セットアップが不明確な場合のみ
- **コンピューティングインフラストラクチャ** - コンピューティングサービスの選択が明確化を必要とする場合のみ
- **ストレージインフラストラクチャ** - データベースまたはストレージの選択が曖昧な場合のみ
- **メッセージングインフラストラクチャ** - メッセージング/キューイングサービスが仕様を必要とする場合のみ
- **ネットワーキングインフラストラクチャ** - ロードバランシングまたはAPIゲートウェイアプローチが不明確な場合のみ
- **モニタリングインフラストラクチャ** - 可観測性ツールが明確化を必要とする場合のみ
- **共有インフラストラクチャ** - インフラストラクチャ共有戦略が曖昧な場合のみ

### ステップ4：計画を保存
- `aidlc-docs/construction/plans/{unit-name}-infrastructure-design-plan.md`として保存
- ユーザー入力のためのすべての[Answer]:タグを含める

### ステップ5：回答を収集して分析
- ユーザーがすべての[Answer]:タグを完了するのを待つ
- 曖昧または曖昧な応答を確認
- 必要に応じてフォローアップ質問を追加

### ステップ6：インフラストラクチャ設計成果物を生成
- `aidlc-docs/construction/{unit-name}/infrastructure-design/infrastructure-design.md`を作成
- `aidlc-docs/construction/{unit-name}/infrastructure-design/deployment-architecture.md`を作成
- 共有インフラストラクチャの場合：`aidlc-docs/construction/shared-infrastructure.md`を作成

### ステップ7：完了メッセージを提示
- この構造で完了メッセージを提示：
     1. **完了アナウンス**（必須）：常にこれで始める：

```markdown
# 🏢 インフラストラクチャ設計完了 - [unit-name]
```

     2. **AIサマリー**（オプション）：インフラストラクチャ設計の構造化された箇条書きサマリーを提供
        - 形式：「インフラストラクチャ設計により[説明]がマッピングされました：」
        - 主要なインフラストラクチャサービスとコンポーネントをリスト（箇条書き）
        - デプロイメントアーキテクチャの決定と理由をリスト
        - クラウドプロバイダーの選択とサービスマッピングを言及
        - ワークフロー指示を含めない（「確認してください」、「お知らせください」、「次のフェーズに進む」、「進む前に」）
        - 事実的でコンテンツに焦点を当てる
     3. **フォーマットされたワークフローメッセージ**（必須）：常にこの正確な形式で終わる：

```markdown
> **📋 <u>**確認が必要：**</u>**  
> 以下のインフラストラクチャ設計を確認してください：`aidlc-docs/construction/[unit-name]/infrastructure-design/`



> **🚀 <u>**次は何ですか？**</u>**
>
> **以下を行うことができます：**
>
> 🔧 **変更を要求** - 確認に基づいてインフラストラクチャ設計への変更を依頼
> ✅ **次のステージに続行** - インフラストラクチャ設計を承認して**コード生成**に進む

---
```

### ステップ8：明示的な承認を待つ
- ユーザーがインフラストラクチャ設計を明示的に承認するまで進まない
- 承認は明確で曖昧さがない必要がある
- ユーザーが変更を要求した場合は、設計を更新して承認プロセスを繰り返す

### ステップ9：承認を記録して進捗を更新
- タイムスタンプ付きでaudit.mdに承認を記録
- タイムスタンプ付きでユーザーの承認応答を記録
- aidlc-state.mdでインフラストラクチャ設計ステージを完了としてマーク
