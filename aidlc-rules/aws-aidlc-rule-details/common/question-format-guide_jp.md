# 質問フォーマットガイド

## 必須：すべての質問はこの形式を使用する必要があります

### ルール：チャットで直接質問しない
**重要**：チャットで直接質問してはいけません。すべての質問は専用の質問ファイルに配置する必要があります。

### 質問ファイルの形式

#### ファイル命名規則
- わかりやすい名前を使用：`{phase-name}-questions.md`
- 例：
  - `classification-questions.md`
  - `requirements-questions.md`
  - `story-planning-questions.md`
  - `design-questions.md`

#### 質問の構造
すべての質問には、意味のあるオプションと最後のオプションとして「その他」を含める必要があります：

```markdown
## Question [番号]
[明確で具体的な質問テキスト]

A) [最初の意味のあるオプション]
B) [2番目の意味のあるオプション]
[...必要に応じて追加のオプション...]
X) その他（以下の[Answer]:タグの後に説明してください）

[Answer]: 
```

**重要**：
- すべての質問に対して「その他」を最後のオプションとして含めることは**必須**です
- 意味のあるオプションのみを含める - スロットを埋めるためにオプションを作成しない
- 意味のある数のオプションを使用（最低2+その他）

### 完全な例

```markdown
# 要件明確化の質問

以下の質問に答えて、要件を明確にしてください。

## Question 1
主なユーザー認証方法は何ですか？

A) ユーザー名とパスワード
B) ソーシャルメディアログイン（Google、Facebook）
C) シングルサインオン（SSO）
D) 多要素認証
E) その他（以下の[Answer]:タグの後に説明してください）

[Answer]: 

## Question 2
これはWebアプリケーションですか、モバイルアプリケーションですか？

A) Webアプリケーション
B) モバイルアプリケーション
C) Webとモバイルの両方
D) その他（以下の[Answer]:タグの後に説明してください）

[Answer]: 

## Question 3
これは新しいプロジェクトですか、既存のコードベースですか？

A) 新しいプロジェクト（グリーンフィールド）
B) 既存のコードベース（ブラウンフィールド）
C) その他（以下の[Answer]:タグの後に説明してください）

[Answer]: 
```

### ユーザー応答形式
ユーザーは[Answer]:タグの後に文字の選択肢を記入して回答します：

```markdown
## Question 1
主なユーザー認証方法は何ですか？

A) ユーザー名とパスワード
B) ソーシャルメディアログイン（Google、Facebook）
C) シングルサインオン（SSO）
D) 多要素認証

[Answer]: C
```

### ユーザー応答の読み取り
ユーザーが完了を確認した後：
1. 質問ファイルを読み取る
2. [Answer]:タグの後の回答を抽出
3. すべての質問が回答されていることを検証
4. 応答に基づいて分析を進める

### 多肢選択のガイドライン

#### オプション数
- 最小：2つの意味のあるオプション+「その他」（A、B、C）
- 一般的：3-4つの意味のあるオプション+「その他」（A、B、C、D、E）
- 最大：5つの意味のあるオプション+「その他」（A、B、C、D、E、F）
- **重要**：スロットを埋めるためだけにオプションを作成しない - 意味のある選択肢のみを含める

#### オプションの品質
- オプションを相互に排他的にする
- 最も一般的なシナリオをカバー
- 意味のある現実的なオプションのみを含める
- **常に最後のオプションとして「その他」を含める**（必須）
- 具体的で明確にする
- **A、B、C、Dスロットを埋めるためにオプションを作成しない**

#### 良い例：
```markdown
## Question 5
どのデータベース技術が使用されますか？

A) リレーショナル（PostgreSQL、MySQL）
B) NoSQLドキュメント（MongoDB、DynamoDB）
C) NoSQLキーバリュー（Redis、Memcached）
D) グラフデータベース（Neo4j、Neptune）
E) その他（以下の[Answer]:タグの後に説明してください）

[Answer]: 
```

#### 悪い例（避ける）：
```markdown
## Question 5
どのデータベースを使用しますか？

A) はい
B) いいえ
C) 多分

[Answer]: 
```

### ワークフローの統合

#### ステップ1：質問ファイルを作成
```markdown
すべての質問を含むaidlc-docs/{phase-name}-questions.mdを作成
```

#### ステップ2：ユーザーに通知
```
「[X]個の質問を含む{phase-name}-questions.mdを作成しました。
各質問に対して[Answer]:タグの後に文字の選択肢を記入して回答してください。
提供されたオプションがニーズに合わない場合は、最後のオプション（その他）を選択して、希望を説明してください。完了したらお知らせください。」
```

#### ステップ3：確認を待つ
ユーザーが「完了」、「完了しました」、「終了」、または類似のことを言うのを待ちます。

#### ステップ4：読み取りと分析
```
aidlc-docs/{phase-name}-questions.mdを読み取る
すべての回答を抽出
完全性を検証
分析を進める
```

### エラー処理

#### 回答の欠落
[Answer]:タグが空の場合：
```
「Question [X]が回答されていません。進行する前に、すべての質問に対して文字の選択肢を使用して回答を提供してください。」
```

#### 無効な回答
回答が有効な文字の選択肢でない場合：
```
「Question [X]に無効な回答'[answer]'があります。
質問に提供されている文字の選択肢のみを使用してください。」
```

#### 曖昧な回答
ユーザーが文字ではなく説明を提供した場合：
```
「Question [X]については、回答に最も適合する文字の選択肢を提供してください。
どれも一致しない場合は、「その他」を選択して[Answer]:タグの後に説明を追加してください。」
```

### 矛盾と曖昧さの検出

**必須**：ユーザーの応答を読み取った後、矛盾と曖昧さをチェックする必要があります。

#### 矛盾の検出
論理的に一貫性のない回答を探す：
- スコープの不一致：「バグ修正」だが「コードベース全体に影響」
- リスクの不一致：「低リスク」だが「破壊的変更」
- タイムラインの不一致：「クイックフィックス」だが「複数のサブシステム」
- 影響の不一致：「単一コンポーネント」だが「重要なアーキテクチャ変更」

#### 曖昧さの検出
不明確または境界線上の応答を探す：
- 複数の分類に適合する可能性のある回答
- 具体性を欠く応答
- 複数の質問にわたる矛盾する指標

#### 明確化の質問の作成
矛盾または曖昧さが検出された場合：

1. **明確化ファイルを作成**：`{phase-name}-clarification-questions.md`
2. **問題を説明**：どのような矛盾/曖昧さが検出されたかを明確に述べる
3. **ターゲットを絞った質問をする**：問題を解決するために多肢選択形式を使用
4. **元の質問を参照**：どの質問に矛盾する回答があったかを示す

**例**：
```markdown
# [フェーズ名] 明確化の質問

あなたの回答に矛盾が検出されました。明確化が必要です：

## 矛盾1：[簡単な説明]
あなたは「[回答A]」（Q[X]:[文字]）を示しましたが、同時に「[回答B]」（Q[Y]:[文字]）も示しました。
これらの応答は矛盾しています。なぜなら[説明]。

### 明確化の質問1
[矛盾を解決するための具体的な質問]

A) [最初の回答に向けて解決するオプション]
B) [2番目の回答に向けて解決するオプション]
C) [中間を提供するオプション]
D) [質問を再構成するオプション]

[Answer]: 

## 曖昧さ1：[簡単な説明]
Q[X]への応答（「[回答]」）は曖昧です。なぜなら[説明]。

### 明確化の質問2
[曖昧さを明確にするための具体的な質問]

A) [明確なオプション1]
B) [明確なオプション2]
C) [明確なオプション3]
D) [明確なオプション4]

[Answer]: 
```

#### 明確化のワークフロー

1. **検出**：すべての応答を矛盾/曖昧さについて分析
2. **作成**：問題が見つかった場合は明確化の質問ファイルを生成
3. **通知**：ユーザーに問題と明確化ファイルについて伝える
4. **待機**：ユーザーが明確化を提供するまで進行しない
5. **再検証**：明確化の後、再度一貫性を確認
6. **進行**：すべての矛盾が解決されたら前進

#### ユーザーメッセージの例
```
「あなたの回答に2つの矛盾を検出しました：

1. バグ修正のスコープ対コードベースへの影響（Q1対Q2）
2. 低リスク対破壊的変更（Q7対Q4）

これらを解決するために2つの質問を含むclassification-clarification-questions.mdを作成しました。
分類を進める前に、これらの明確化の質問に回答してください。」
```

### ベストプラクティス

1. **具体的に**：質問は明確で曖昧さがないようにする
2. **包括的に**：必要なすべての情報をカバー
3. **簡潔に**：質問を1つのトピックに焦点を当てる
4. **実用的に**：オプションは現実的で実行可能であるべき
5. **一貫性を保つ**：すべての質問ファイルで同じ形式を使用

### フェーズ固有の例

#### 2つの意味のあるオプションの例：
```markdown
## Question 1
これは新しいプロジェクトですか、既存のコードベースですか？

A) 新しいプロジェクト（グリーンフィールド）
B) 既存のコードベース（ブラウンフィールド）
C) その他（以下の[Answer]:タグの後に説明してください）

[Answer]: 
```

#### 3つの意味のあるオプションの例：
```markdown
## Question 2
デプロイメントターゲットは何ですか？

A) クラウド（AWS、Azure、GCP）
B) オンプレミスサーバー
C) ハイブリッド（クラウドとオンプレミスの両方）
D) その他（以下の[Answer]:タグの後に説明してください）

[Answer]: 
```

#### 4つの意味のあるオプションの例：
```markdown
## Question 3
どのアーキテクチャパターンを使用すべきですか？

A) モノリシックアーキテクチャ
B) マイクロサービスアーキテクチャ
C) サーバーレスアーキテクチャ
D) イベント駆動型アーキテクチャ
E) その他（以下の[Answer]:タグの後に説明してください）

[Answer]: 
```

## まとめ

**覚えておいてください**：
- ✅ 常に質問ファイルを作成
- ✅ 常に多肢選択形式を使用
- ✅ **常に最後のオプションとして「その他」を含める（必須）**
- ✅ 意味のあるオプションのみを含める - スロットを埋めるためにオプションを作成しない
- ✅ 常に[Answer]:タグを使用
- ✅ 常にユーザーの完了を待つ
- ✅ 常に矛盾について応答を検証
- ✅ 必要に応じて常に明確化ファイルを作成
- ✅ 進行する前に常に矛盾を解決
- ❌ チャットで質問しない
- ❌ A、B、C、Dを持つためだけにオプションを作成しない
- ❌ 回答なしで進行しない
- ❌ 未解決の矛盾で進行しない
- ❌ 曖昧な応答について推測しない
